\hypertarget{_t_m1637_8c_source}{}\doxysection{TM1637.\+c}
\label{_t_m1637_8c_source}\index{src/ledanzeige/TM1637.c@{src/ledanzeige/TM1637.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00001}00001 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00002}00002 \textcolor{comment}{ * ============================================================================}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00003}00003 \textcolor{comment}{ * Author:      Tobias Muth}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00004}00004 \textcolor{comment}{ * Datum:       18.09.2017}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00005}00005 \textcolor{comment}{ *                           Definitions for TM1637 (Vorgabe)}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00006}00006 \textcolor{comment}{ * ============================================================================}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00007}00007 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00009}00009 \textcolor{preprocessor}{\#include "{}ledanzeige/TM1637.h"{}}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00010}00010 \textcolor{preprocessor}{\#include "{}ledanzeige/TM1637\_intern.h"{}}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00011}00011 \textcolor{preprocessor}{\#include "{}ledanzeige/segmentanzeige.h"{}}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00013}00013 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00014}00014 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00015}00015 \textcolor{preprocessor}{\#include <wiringPi.h>}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00017}00017 \textcolor{comment}{/* Definition von Konstanten fuer die Segmentanzeige */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00018}00018 \textcolor{preprocessor}{\#define ADDR\_AUTO     0x40}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00019}00019 \textcolor{preprocessor}{\#define ADDR\_FIXED    0x44}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00020}00020 \textcolor{preprocessor}{\#define STARTADDR     0xc0}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00021}00021 \textcolor{preprocessor}{\#define DOT\_OFFSET    0x80}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00022}00022 \textcolor{preprocessor}{\#define BRIGHT\_OFFSET 0x88}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00024}00024 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00025}00025 \textcolor{comment}{ * Zuordnung der LEDs eines Segments zu den Bits des gesendeten Bytes}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00026}00026 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00027}00027 \textcolor{comment}{ *     -\/A-\/}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00028}00028 \textcolor{comment}{ *  F |   | B}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00029}00029 \textcolor{comment}{ *     -\/G-\/}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00030}00030 \textcolor{comment}{ *  E |   | C}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00031}00031 \textcolor{comment}{ *     -\/D-\/}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00032}00032 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00033}00033 \textcolor{keyword}{const} \textcolor{keywordtype}{byte} NUMBER\_TO\_BYTE[] = \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00034}00034 \textcolor{comment}{/*            XGFEDCBA; X=0: Dot aus, X=1: Dot an */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00035}00035 0x3f, \textcolor{comment}{/* 0: 0b00111111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00036}00036 0x06, \textcolor{comment}{/* 1: 0b00000110 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00037}00037 0x5b, \textcolor{comment}{/* 2: 0b01011011 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00038}00038 0x4f, \textcolor{comment}{/* 3: 0b01001111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00039}00039 0x66, \textcolor{comment}{/* 4: 0b01100110 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00040}00040 0x6d, \textcolor{comment}{/* 5: 0b01101101 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00041}00041 0x7d, \textcolor{comment}{/* 6: 0b01111101 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00042}00042 0x07, \textcolor{comment}{/* 7: 0b00000111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00043}00043 0x7f, \textcolor{comment}{/* 8: 0b01111111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00044}00044 0x6f, \textcolor{comment}{/* 9: 0b01101111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00045}00045 0x77, \textcolor{comment}{/* A: 0b01110111 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00046}00046 0x7c, \textcolor{comment}{/* b: 0b01111100 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00047}00047 0x39, \textcolor{comment}{/* C: 0b00111001 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00048}00048 0x5e, \textcolor{comment}{/* d: 0b01011110 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00049}00049 0x79, \textcolor{comment}{/* E: 0b01111001 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00050}00050 0x71 \textcolor{comment}{/* F: 0b01110001 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00051}00051 \};}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00053}00053 \textcolor{comment}{/* Vorwaerts-\/Deklaration (Funktionen nicht in Schnittstelle) */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00054}00054 \textcolor{keyword}{static} \textcolor{keywordtype}{void} TM1637\_start(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00055}00055 \textcolor{keyword}{static} \textcolor{keywordtype}{void} TM1637\_stop(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00057}00057 \textcolor{comment}{/* globale Variable fuer die Helligkeit */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00058}00058 \textcolor{keyword}{static} brightness bright = BRIGHT;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00060}00060 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00061}00061 \textcolor{comment}{ * Initialisierung von WiringPi und der Segmentanzeige.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00062}00062 \textcolor{comment}{ * Muss genau einmal vor der Benutzung der Anzeige aufgerufen werden.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00063}00063 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00064}00064 \textcolor{keywordtype}{int} TM1637\_setup() \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00065}00065     \textcolor{keyword}{static} \textcolor{keywordtype}{int} device\_initialised = 0;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00067}00067     \textcolor{keywordflow}{if} (!device\_initialised) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00068}00068         \textcolor{comment}{/* Versuche WiringPi zu initialisieren */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00069}00069         \textcolor{keywordflow}{if} (wiringPiSetup() == -\/1) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00070}00070             fprintf(stderr, \textcolor{stringliteral}{"{}setup wiringPi failed ! n"{}});}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00071}00071             \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00072}00072         \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00074}00074         \textcolor{comment}{/* Jetzt noch die Segmentanzeige initialisieren */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00075}00075         \textcolor{comment}{/* beide Pins als Output konfigurieren */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00076}00076         pinMode(PIN\_CLOCK, OUTPUT);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00077}00077         pinMode(PIN\_DATA, OUTPUT);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00079}00079         \textcolor{comment}{/* Vorbereitung für start(): beide Pins auf 1 */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00080}00080         digitalWrite(PIN\_CLOCK, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00081}00081         digitalWrite(PIN\_DATA, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00082}00082         delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00084}00084         \textcolor{comment}{/* Anzeige löschen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00085}00085         TM1637\_clear\_display();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00087}00087         \textcolor{comment}{/* Initialisierung nicht mehrfach durchfuehren*/}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00088}00088         device\_initialised = 1;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00090}00090         \textcolor{keywordflow}{return} EXIT\_SUCCESS;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00091}00091     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00093}00093     \textcolor{comment}{/* FAILURE falls bereits initialisiert */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00094}00094     \textcolor{keywordflow}{return} EXIT\_FAILURE;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00095}00095 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00096}00096 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00097}00097 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00098}00098 \textcolor{comment}{ * Low-\/Level Funktion zum Abschliessen des Datentransfers.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00099}00099 \textcolor{comment}{ * Muss am Ende von TM1637\_write\_byte() aufgerufen werden.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00100}00100 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00101}00101 \textcolor{keywordtype}{void} TM1637\_ack() \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00102}00102     \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00104}00104     \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00105}00105 \textcolor{comment}{     * Starte ack():}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00106}00106 \textcolor{comment}{     * CLK auf 0, DIO auf 1 (wird durch den Chip heruntergezogen)}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00107}00107 \textcolor{comment}{     */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00108}00108     digitalWrite(PIN\_CLOCK, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00109}00109     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00111}00111     \textcolor{comment}{/* DIO als Input konfigurieren (wir wollen die 0 vom runterziehen lesen) */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00112}00112     digitalWrite(PIN\_DATA, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00113}00113     pinMode(PIN\_DATA, INPUT);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00114}00114     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00116}00116     \textcolor{comment}{/* CLK auf 1: Warte auf das ACK vom Chip */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00117}00117     digitalWrite(PIN\_CLOCK, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00118}00118     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00120}00120     \textcolor{comment}{/* versuche die 0 auf dem DIO zu lesen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00121}00121     \textcolor{keywordflow}{while} (digitalRead(PIN\_DATA)) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00122}00122         count += 1;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00123}00123         \textcolor{keywordflow}{if} (count == 200) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00124}00124             \textcolor{keywordflow}{break}; \textcolor{comment}{/* wir geben auf */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00125}00125         \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00126}00126     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00128}00128     \textcolor{comment}{/* CLK und DIO auf 0: Ausgangspunkt fuer stop */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00129}00129     digitalWrite(PIN\_CLOCK, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00130}00130     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00132}00132     \textcolor{comment}{/* DIO-\/Pin restaurieren */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00133}00133     pinMode(PIN\_DATA, OUTPUT);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00134}00134     digitalWrite(PIN\_DATA, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00135}00135     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00136}00136 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00137}00137 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00138}00138 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00139}00139 \textcolor{comment}{ * Low-\/Level Funktion zum Setzen der Helligkeit aller Segmente.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00140}00140 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00141}00141 \textcolor{keywordtype}{void} TM1637\_brightness(brightness b) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00142}00142     bright = b;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00143}00143 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00145}00145 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00146}00146 \textcolor{comment}{ * Low-\/Level Funktionen zum Loeschen aller (bzw. eines) Segmente(s).}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00147}00147 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00148}00148 \textcolor{keywordtype}{void} TM1637\_clear\_display(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00149}00149     TM1637\_clear\_segment(SEG1);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00150}00150     TM1637\_clear\_segment(SEG2);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00151}00151     TM1637\_clear\_segment(SEG3);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00152}00152     TM1637\_clear\_segment(SEG4);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00153}00153 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00155}00155 \textcolor{keywordtype}{void} TM1637\_clear\_segment(segment seg) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00156}00156     TM1637\_display(seg, OFF, OFF);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00157}00157 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00158}00158 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00159}00159 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00160}00160 \textcolor{comment}{ * Low-\/Level Funktionen zum Setzen eines Segments.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00161}00161 \textcolor{comment}{ * Der Parameter data ist eine Bitsequenz nach NUMBER\_TO\_BYTE, ohne den Dezimalpunkt.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00162}00162 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00163}00163 \textcolor{keywordtype}{void} TM1637\_display(segment seg, \textcolor{keywordtype}{byte} data, dot point) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00164}00164     \textcolor{keywordtype}{byte} seg\_data;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00166}00166     seg\_data = data;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00167}00167     \textcolor{keywordflow}{if} (point == ON) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00168}00168         seg\_data = seg\_data + DOT\_OFFSET;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00169}00169     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00171}00171     \textcolor{comment}{/* CMD1: Modus setzen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00172}00172     TM1637\_start();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00173}00173     TM1637\_write\_byte(ADDR\_FIXED);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00174}00174     TM1637\_stop();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00176}00176     \textcolor{comment}{/* CMD2: Daten fuer Segment schicken */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00177}00177     TM1637\_start();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00178}00178     TM1637\_write\_byte(seg | STARTADDR);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00179}00179     TM1637\_write\_byte(seg\_data);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00180}00180     TM1637\_stop();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00182}00182     \textcolor{comment}{/* CMD3: Helligkeit setzen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00183}00183     TM1637\_start();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00184}00184     TM1637\_write\_byte(BRIGHT\_OFFSET + bright);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00185}00185     TM1637\_stop();}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00186}00186 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00188}00188 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00189}00189 \textcolor{comment}{ * High-\/Level Funktionen zum Setzen eines Segments.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00190}00190 \textcolor{comment}{ * Der Parameter number ist eine Gleitkommazahl zwischen -\/99.9 und 999.9 und}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00191}00191 \textcolor{comment}{ * wird auf der Segmentanzeige mit drei Vorkomma-\/ und einer Nachkommstelle}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00192}00192 \textcolor{comment}{ * angezeigt.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00193}00193 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00194}00194 \textcolor{keywordtype}{void} TM1637\_display\_number(\textcolor{keywordtype}{float} number) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00195}00195     TM1637\_display(SEG1, TM1637\_calculate\_display(number, SEG1), OFF);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00196}00196     TM1637\_display(SEG2, TM1637\_calculate\_display(number, SEG2), OFF);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00197}00197     TM1637\_display(SEG3, TM1637\_calculate\_display(number, SEG3), ON);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00198}00198     TM1637\_display(SEG4, TM1637\_calculate\_display(number, SEG4), OFF);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00199}00199 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00201}00201 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00202}00202 \textcolor{comment}{ * Hilfsfunktion: Berechnet zu number die Bitsequenz für die Stelle seq.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00203}00203 \textcolor{comment}{ * Wird in TM1637\_display\_number() genutzt.}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00204}00204 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00205}00205 \textcolor{keywordtype}{byte} TM1637\_calculate\_display(\textcolor{keywordtype}{float} number, segment seg) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00206}00206     \textcolor{keyword}{static} \textcolor{keywordtype}{int} lastnumber = 0;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00207}00207     \textcolor{keyword}{static} \textcolor{keywordtype}{byte} segmente[] = \{ 0x3f, 0x3f, 0x3f, 0x3f \};}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00208}00208     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} digit;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00209}00209     \textcolor{keywordtype}{int} reminder;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00211}00211     \textcolor{comment}{/* Range Check */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00212}00212     \textcolor{keywordflow}{if} (number > 999.9f) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00213}00213         fprintf(stderr,}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00214}00214                 \textcolor{stringliteral}{"{}calculateDisplay does not accept values higher than 999.9 \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00215}00215         \textcolor{keywordflow}{return} 0x00; \textcolor{comment}{/* Error value */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00216}00216     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00217}00217     \textcolor{keywordflow}{if} (number < -\/99.9f) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00218}00218         fprintf(stderr,}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00219}00219                 \textcolor{stringliteral}{"{}calculateDisplay does not accept values lower than -\/99.9 \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00220}00220         \textcolor{keywordflow}{return} 0x00; \textcolor{comment}{/* Error value */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00221}00221     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00222}00222 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00223}00223     reminder = (int) (number * 10.0);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00224}00224     \textcolor{keywordflow}{if} (reminder != lastnumber) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00225}00225         \textcolor{comment}{/* Neue Zahl ... alles neu berechnen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00226}00226         lastnumber = reminder;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00227}00227 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00228}00228         \textcolor{comment}{/* Vorzeichenbehandlung */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00229}00229         \textcolor{keywordflow}{if} (reminder >= 0) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00230}00230             \textcolor{comment}{/* calculate first segment and subtract value from the rest of the value to be displayed */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00231}00231             digit = reminder / 1000;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00232}00232             reminder = reminder -\/ digit * 1000;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00233}00233             segmente[0] = NUMBER\_TO\_BYTE[digit];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00234}00234         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00235}00235             reminder = abs(reminder);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00236}00236 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00237}00237             \textcolor{comment}{/* first segment displays a "{}-\/"{} */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00238}00238             segmente[0] = 0x40;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00239}00239         \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00241}00241         \textcolor{comment}{/* calculate second segment and subtract value from the rest of the value to be displayed */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00242}00242         digit = reminder / 100;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00243}00243         reminder = reminder -\/ digit * 100;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00244}00244         segmente[1] = NUMBER\_TO\_BYTE[digit];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00245}00245 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00246}00246         \textcolor{comment}{/* calculate third segment and subtract value from the rest of the value to be displayed */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00247}00247         digit = reminder / 10;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00248}00248         reminder = reminder -\/ digit * 10;}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00249}00249         segmente[2] = NUMBER\_TO\_BYTE[digit];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00251}00251         \textcolor{comment}{/* calculate fourth segment and subtract value from the rest of the value to be displayed */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00252}00252         segmente[3] = NUMBER\_TO\_BYTE[reminder];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00253}00253     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00254}00254 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00255}00255     \textcolor{comment}{/* Rueckgabe */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00256}00256     \textcolor{keywordflow}{switch} (seg) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00257}00257     \textcolor{keywordflow}{case} SEG1:}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00258}00258         \textcolor{keywordflow}{return} segmente[0];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00259}00259     \textcolor{keywordflow}{case} SEG2:}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00260}00260         \textcolor{keywordflow}{return} segmente[1];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00261}00261     \textcolor{keywordflow}{case} SEG3:}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00262}00262         \textcolor{keywordflow}{return} segmente[2];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00263}00263     \textcolor{keywordflow}{case} SEG4:}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00264}00264         \textcolor{keywordflow}{return} segmente[3];}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00265}00265     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00266}00266         \textcolor{keywordflow}{return} 0x00; \textcolor{comment}{/* Error value */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00267}00267     \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00268}00268 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00270}00270 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00271}00271 \textcolor{comment}{ * Interne Hilfsfunktion: Start des Datentransfers}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00272}00272 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00273}00273 \textcolor{keyword}{static} \textcolor{keywordtype}{void} TM1637\_start(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00274}00274     \textcolor{comment}{/* beide Pins muessen bei 1 starten}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00275}00275 \textcolor{comment}{     *}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00276}00276 \textcolor{comment}{     * Sollte nach init() bzw. nach stop() bereit der Fall sein,}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00277}00277 \textcolor{comment}{     * aber sicherheitshalber noch einmal einstellen}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00278}00278 \textcolor{comment}{     */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00279}00279     digitalWrite(PIN\_CLOCK, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00280}00280     digitalWrite(PIN\_DATA, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00281}00281     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00282}00282 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00283}00283     \textcolor{comment}{/* DIO muss auf 0 gehen => Start */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00284}00284     digitalWrite(PIN\_DATA, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00285}00285     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00287}00287     \textcolor{comment}{/* CLK muss ebenfalls auf 0 gehen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00288}00288     digitalWrite(PIN\_CLOCK, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00289}00289     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00290}00290 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00292}00292 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00293}00293 \textcolor{comment}{ * Interne Hilfsfunktion: Ende des Datentransfers}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00294}00294 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00295}00295 \textcolor{keyword}{static} \textcolor{keywordtype}{void} TM1637\_stop(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00296}00296     \textcolor{comment}{/* beide Pins muessen bei 0 starten}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00297}00297 \textcolor{comment}{     *}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00298}00298 \textcolor{comment}{     * Sollte nach ack() bereits der Fall sein,}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00299}00299 \textcolor{comment}{     * aber sicherheitshalber noch einmal einstellen}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00300}00300 \textcolor{comment}{     */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00301}00301     digitalWrite(PIN\_CLOCK, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00302}00302     digitalWrite(PIN\_DATA, LOW);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00303}00303     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00304}00304 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00305}00305     \textcolor{comment}{/* CLK muss auf 1 gehen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00306}00306     digitalWrite(PIN\_CLOCK, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00307}00307     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00308}00308 }
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00309}00309     \textcolor{comment}{/* DIO muss ebenfalls auf 1 gehen */}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00310}00310     digitalWrite(PIN\_DATA, HIGH);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00311}00311     delayMicroseconds(DELAY\_TIMER);}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00312}00312 \}}
\DoxyCodeLine{\Hypertarget{_t_m1637_8c_source_l00313}00313 }

\end{DoxyCode}
